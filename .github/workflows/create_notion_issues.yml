name: Crear Issues desde Notion

on:
  workflow_dispatch: # Permite ejecutar manualmente

jobs:
  create_issues:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Crear issues desde archivos .md
        env:
          TOKEN: ${{ secrets.MY_GITHUB_PAT }} # Tu Personal Access Token
          OWNER: s11-25-equipo-48-WebApp
          REPO: backend
        run: |
          # Carpeta donde están los archivos exportados de Notion
          ISSUE_DIR="./notion_issues"

          # Iterar todos los archivos .md
          for file in $ISSUE_DIR/*.md; do
            echo "Procesando $file"

            # Extraer título: primera línea que empieza con #
            TITLE=$(head -n 1 "$file" | sed 's/^# //')

            # Extraer el cuerpo: todo el archivo
            BODY=$(cat "$file" | sed '1d') # elimina la primera línea para que no se duplique el título

            # Reemplaza comillas dobles para que JSON no falle
            BODY_JSON=$(echo "$BODY" | sed 's/"/\\"/g')

            # Crear issue
            curl -s -X POST \
              -H "Authorization: token $TOKEN" \
              -H "Accept: application/vnd.github+json" \
              https://api.github.com/repos/$OWNER/$REPO/issues \
              -d "{\"title\":\"$TITLE\",\"body\":\"$BODY_JSON\"}"
          done
